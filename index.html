<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wallet Connect Stable</title>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>

<style>
body{
  background:#000;
  color:#fff;
  font-family:Arial;
  text-align:center;
  padding-top:100px;
}
button{
  padding:15px 30px;
  background:gold;
  border:none;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>

<body>

<h2>Universal Wallet Connect</h2>
<button onclick="connectWallet()">Connect Wallet</button>
<div id="walletDisplay" style="margin-top:20px;color:gold;"></div>

<script>

let provider, signer, userAddress;

const ADMIN = "0x53ba2d865be750d0e2d4d01bcb0a46ec1684c46b";

async function connectWallet() {

  try {

    // ðŸ”¥ If no injected wallet (mobile normal browser)
    if (!window.ethereum) {

      const dappUrl = window.location.href;
      const metamaskUrl =
        "https://metamask.app.link/dapp/" +
        dappUrl.replace(/^https?:\/\//,'');

      window.location.href = metamaskUrl;
      return;
    }

    // ðŸ”¥ Request account
    await window.ethereum.request({
      method: "eth_requestAccounts"
    });

    provider = new ethers.providers.Web3Provider(window.ethereum);
    signer = provider.getSigner();
    userAddress = await signer.getAddress();

    // ðŸ”¥ Network check
    const network = await provider.getNetwork();

    if (network.chainId !== 56) {

      try {
        await window.ethereum.request({
          method: "wallet_switchEthereumChain",
          params: [{ chainId: "0x38" }] // BSC
        });
      } catch (err) {
        alert("Please switch to BNB Smart Chain");
        return;
      }
    }

    // ðŸ”¥ Show wallet
    document.getElementById("walletDisplay").innerHTML =
      "Connected: " + userAddress;

    // ðŸ”¥ Admin detection
    if (userAddress.toLowerCase() === ADMIN.toLowerCase()) {
      const adminPanel = document.getElementById("adminPanel");
      if (adminPanel) adminPanel.style.display = "block";
    }

    // ðŸ”¥ Load data safely
    if (typeof loadData === "function") await loadData();
    if (typeof loadLivePrice === "function") await loadLivePrice();

  } catch (err) {

    console.log(err);
    alert("Connection Failed: " + err.message);

  }
}

</script>

</body>
</html>
