<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wallet Connect Test</title>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>

<script src="https://unpkg.com/@web3modal/ethereum@2.7.1/dist/index.umd.js"></script>
<script src="https://unpkg.com/@web3modal/html@2.7.1/dist/index.umd.js"></script>

<style>
body{
  background:#000;
  color:#fff;
  font-family:Arial;
  text-align:center;
  padding-top:100px;
}
button{
  padding:15px 30px;
  background:gold;
  border:none;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>

<body>

<h2>Wallet Connect Test</h2>

<button onclick="connectWallet()">Connect Wallet</button>

<div id="walletDisplay" style="margin-top:20px;color:gold;"></div>

<script>

<script>

let provider, signer, userAddress;
let web3Modal;

const ADMIN = "0x53ba2d865be750d0e2d4d01bcb0a46ec1684c46b";
const projectId = "d1b044ae2663b9697bc5ab584bfb57e5";

const chains = [{
  chainId: 56,
  name: "BNB Smart Chain",
  currency: "BNB",
  explorerUrl: "https://bscscan.com",
  rpcUrl: "https://bsc-dataseed.binance.org/"
}];

const { EthereumClient } = window.Web3ModalEthereum;
const { Web3Modal } = window.Web3Modal;

const ethereumClient = new EthereumClient({
  chains,
  projectId
});

web3Modal = new Web3Modal({
  projectId,
  themeMode: "dark"
}, ethereumClient);

async function connectWallet() {

  try {

    // ðŸ”¥ PRIORITY 1: If wallet injected (MetaMask browser / Trust browser)
    if (window.ethereum) {

      const accounts = await window.ethereum.request({
        method: "eth_requestAccounts"
      });

      provider = new ethers.providers.Web3Provider(window.ethereum);
      signer = provider.getSigner();
      userAddress = accounts[0];

    } else {

      // ðŸ”¥ PRIORITY 2: Outside browser â†’ WalletConnect
      const walletProvider = await web3Modal.connect();

      provider = new ethers.providers.Web3Provider(walletProvider);
      signer = provider.getSigner();
      userAddress = await signer.getAddress();
    }

    const network = await provider.getNetwork();

    // ðŸ”¥ Auto switch to BSC
    if (network.chainId !== 56) {

      try {
        await provider.provider.request({
          method: "wallet_switchEthereumChain",
          params: [{ chainId: "0x38" }]
        });
      } catch (err) {
        alert("Please switch to BNB Smart Chain");
        return;
      }
    }

    document.getElementById("walletDisplay").innerHTML =
      "Connected: " + userAddress;

    // âœ… ADMIN CHECK
    if (userAddress.toLowerCase() === ADMIN.toLowerCase()) {
      document.getElementById("adminPanel").style.display = "block";
      if (typeof loadRates === "function") await loadRates();
    }

    if (typeof loadData === "function") await loadData();
    if (typeof loadLivePrice === "function") await loadLivePrice();

  } catch (err) {
    console.log(err);
    alert("Connection Failed");
  }
}

</script>

</body>
</html>
